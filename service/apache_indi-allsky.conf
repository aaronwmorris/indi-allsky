<VirtualHost *:80>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^/(.*) https://%{SERVER_NAME}/$1 [R,L]
</VirtualHost>

<VirtualHost *:443>
    WSGIDaemonProcess indi-allsky user=%ALLSKY_USER% threads=5
    WSGIProcessGroup %{GLOBAL}
    WSGIScriptAlias /indi-allsky %ALLSKY_DIRECTORY%/wsgi.py \
        application-group='%{GLOBAL}' process-group='%{GLOBAL}'
    WSGIScriptReloading On

    <Directory %ALLSKY_DIRECTORY%>
        Require all granted
    </Directory>

    Alias /allsky/static %ALLSKY_DIRECTORY%/indi_allsky/flask/static
    Alias /allsky/images /var/www/html/allsky/images

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    #Header always set Strict-Transport-Security "max-age=604800; includeSubDomains"  # 1 week
</VirtualHost>

WSGIPythonOptimize 1
WSGIPythonHome %ALLSKY_DIRECTORY%/virtualenv/indi-allsky
WSGIPythonPath %ALLSKY_DIRECTORY%/virtualenv/indi-allsky:%ALLSKY_DIRECTORY%
WSGIApplicationGroup %{GLOBAL}
